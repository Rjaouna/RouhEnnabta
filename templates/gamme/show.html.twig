{% extends 'base.html.twig' %}

{% block title %}
	Gamme –
	{{ gamme.name }}
{% endblock %}

{% block body %}

	{# ================= HEADER / HERO ================= #}
	<section class="product-header d-flex align-items-center" style="
				background-image: url('{{ asset('assets/img/huiles-essentielles-et-aromatherapie-3.jpg') }}');
				background-size: cover;
				background-position: center;
				min-height: 220px;
			">
		<div class="container text-white">

			<nav aria-label="breadcrumb" class="mb-3">
				<ol class="breadcrumb mb-0">
					<li class="breadcrumb-item">
						<a href="{{ path('app_home') }}" class="text-white text-decoration-none">
							Accueil
						</a>
					</li>
					<li class="breadcrumb-item active text-white" aria-current="page">
						{{ gamme.name }}
					</li>
				</ol>
			</nav>

			<h1 class="fw-bold mb-0">
				{{ gamme.name }}
			</h1>

		</div>
	</section>

	{# ================= DESCRIPTION GAMME ================= #}
	{% if gamme.description %}
		<section class="container py-4">
			<p class="text-muted fs-5 mb-0">
				{{ gamme.description }}
			</p>
		</section>
	{% endif %}

	{# ================= LISTE PRODUITS ================= #}
	<section class="container py-5">

		{% if products|length == 0 %}
			<div class="alert alert-info text-center">
				Aucun produit disponible pour cette gamme.
			</div>
		{% endif %}

		<div class="row g-4">

			{% for product in products %}
				<div class="col-md-4">

					<div
						class="card h-100 shadow-sm border-0 rounded-4">

						{# IMAGE PRODUIT #}
						<div class="p-3 text-center">
							{% set mainImage = product.mainImage %}

							{% if mainImage %}
								<img src="{{ asset('uploads/products/' ~ mainImage.filename) }}" class="img-fluid rounded-3" alt="{{ product.name }}">
							{% else %}
								<img src="{{ asset('assets/img/placeholder-product.jpg') }}" class="img-fluid rounded-3" alt="{{ product.name }}">
							{% endif %}
						</div>

						{# CONTENU #}
						<div class="card-body d-flex flex-column">

							<h5 class="fw-semibold mb-2">
								{{ product.name }}
							</h5>

							<p class="small text-muted flex-grow-1">
								{{ product.description|striptags|slice(0, 100) }}…
							</p>

							{# RECETTES ASSOCIÉES #}
							<div class="mb-3">
								{% set nbRecettes = product.recettes|length %}

								{% if nbRecettes > 0 %}
									<a href="{{ path('product_recettes', { slug: product.slug }) }}" class="text-decoration-none text-success fw-semibold small d-flex align-items-center gap-1">
										<i class="bi bi-journal-text"></i>
										Recettes associées
										<span class="badge bg-success-subtle text-success">
											{{ nbRecettes }}
										</span>
									</a>
								{% else %}
									<span class="text-muted small d-flex align-items-center gap-1">
										<i class="bi bi-journal-x"></i>
										Aucune recette associée
									</span>
								{% endif %}
							</div>

						</div>

						{# ACTION #}
						<div class="card-footer bg-white border-0 px-3 pb-3">
							<a href="{{ path('product_show', { slug: product.slug }) }}" class="btn btn-outline-success w-100 rounded-pill">
								Voir le produit
							</a>
						</div>

					</div>

				</div>
			{% endfor %}

		</div>

	</section>

{% endblock %}

