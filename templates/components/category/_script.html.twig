 <script>
// =====================
// ELEMENTS
// =====================
const categoryForm = document.getElementById('category-form');
const categoryList = document.getElementById('category-list');

const categoryId = document.getElementById('category-id');
const categoryName = document.getElementById('category-name');
const categoryDescription = document.getElementById('category-description');
const categoryActive = document.getElementById('category-active');
const categoryImage = document.getElementById('category-image'); // input file

// =====================
// LOAD LIST
// =====================
function loadCategories() {
  fetch('/api/categories')
    .then(r => r.json())
    .then(data => {
      categoryList.innerHTML = '';

      data.forEach(c => {
categoryList.innerHTML += `
<tr class="${c.isActive ? '' : 'table-secondary'}">

	<td>
<img src="${c.image
		  ? '/uploads/categories/' + c.image
: '/assets/img/placeholder.jpg'

		}"

 alt="${c.name}" class="rounded" style="width: 50px; height: 50px; object-fit: cover;">

	</td>

	<td>
		<strong>${c.name}</strong>
	</td>

	<td class="text-muted">
		${c.description}
	</td>

	<td>
		${c.isActive
		        ? '<span class="badge bg-success">Active</span>'
			        : '<span class="badge bg-danger">Inactive</span>'}
	</td>

	<td class="text-end">
		<button class="btn btn-sm btn-outline-warning me-1" onclick="editCategory(${c.id})">‚úèÔ∏è</button>

		<button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${c.id})">üóë</button>
	</td>

</tr>
`;


      });
    });
}

// =====================
// EDIT
// =====================
function editCategory(id) {
  fetch(`/api/categories/${id}`)
    .then(r => r.json())
    .then(c => {
      categoryId.value = c.id;
      categoryName.value = c.name;
      categoryDescription.value = c.description ?? '';
      categoryActive.checked = c.isActive;



     const modalEl = document.getElementById('categoryModal');
const modal = bootstrap.Modal.getInstance(modalEl);

if (modal) {
  modal.hide();
}



    });
}

// =====================
// DELETE
// =====================
function deleteCategory(id) {
  if (!confirm('Supprimer cette cat√©gorie ?')) return;

  fetch(`/api/categories/${id}`, { method: 'DELETE' })
    .then(() => loadCategories());
}

// =====================
// SUBMIT (VICH / FORMDATA)
// =====================
categoryForm.addEventListener('submit', e => {
  e.preventDefault();

  const id = categoryId.value;
  const method = id ? 'POST' : 'POST'; // PUT simul√©
  const url = id
    ? `/api/categories/${id}`
    : '/api/categories';

  const formData = new FormData();
  formData.append('name', categoryName.value);
  formData.append('description', categoryDescription.value ?? '');
  formData.append('isActive', categoryActive.checked ? 1 : 0);

  if (categoryImage && categoryImage.files[0]) {
    formData.append('image', categoryImage.files[0]);
  }

  fetch(url, {
    method,
    body: formData
  })
  .then(() => {
    categoryForm.reset();
    categoryId.value = '';
    loadCategories();

    const modalEl = document.getElementById('categoryModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    if (modal) modal.hide();
  });
});

// =====================
// INIT
// =====================
loadCategories();
</script>

