 <script>
// =====================
// ELEMENTS
// =====================
const categoryForm = document.getElementById('category-form');
const categoryList = document.getElementById('category-list');

const categoryId = document.getElementById('category-id');
const categoryName = document.getElementById('category-name');
const categoryDescription = document.getElementById('category-description');
const categoryActive = document.getElementById('category-active');

// =====================
// LOAD LIST
// =====================
function loadCategories() {
  fetch('/api/categories')
    .then(r => r.json())
    .then(data => {
      categoryList.innerHTML = '';

      data.forEach(c => {
        categoryList.innerHTML += `
          <tr class="${c.isActive ? '' : 'table-secondary'}">
            <td>
              <strong>${c.name}</strong>
            </td>

            <td class="text-muted">
              /${c.slug}
            </td>

            <td>
              ${c.isActive
                ? '<span class="badge bg-success">Active</span>'
                : '<span class="badge bg-danger">Inactive</span>'}
            </td>

            <td class="text-end">
              <button class="btn btn-sm btn-outline-warning me-1"
                onclick="editCategory(${c.id})">
                ‚úèÔ∏è
              </button>

              <button class="btn btn-sm btn-outline-danger"
                onclick="deleteCategory(${c.id})">
                üóë
              </button>
            </td>
          </tr>
        `;
      });
    });
}

// =====================
// EDIT
// =====================
function editCategory(id) {
  fetch(`/api/categories/${id}`)
    .then(r => r.json())
    .then(c => {
      categoryId.value = c.id;
      categoryName.value = c.name;
      categoryDescription.value = c.description ?? '';
      categoryActive.checked = c.isActive;

      const modal = bootstrap.Modal.getOrCreateInstance(
        document.getElementById('categoryModal')
      );
      modal.show();
    });
}

// =====================
// DELETE
// =====================
function deleteCategory(id) {
  if (!confirm('Supprimer cette cat√©gorie ?')) return;

  fetch(`/api/categories/${id}`, { method: 'DELETE' })
    .then(() => loadCategories());
}

// =====================
// SUBMIT
// =====================
categoryForm.addEventListener('submit', e => {
  e.preventDefault();

  const id = categoryId.value;
  const method = id ? 'PUT' : 'POST';
  const url = id ? `/api/categories/${id}` : '/api/categories';

  fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: categoryName.value,
      description: categoryDescription.value,
      isActive: categoryActive.checked,
    })
  })
  .then(() => {
    categoryForm.reset();
    categoryId.value = '';
    loadCategories();

    const modalEl = document.getElementById('categoryModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    if (modal) modal.hide();
  });
});

// =====================
// INIT
// =====================
loadCategories();
</script>

