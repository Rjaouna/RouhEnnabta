{{ include('_partials/_topnav.html.twig') }}

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top">
	<div class="container">

		<a class="navbar-brand d-flex align-items-center gap-2" href="{{ path('app_home') }}">
			<img src="{{ asset('assets/img/logo-rouh-ennabta.png') }}" alt="RouhEnnabta" height="55">
		</a>

		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="mainNavbar">

			<ul class="navbar-nav mx-auto fw-semibold gap-lg-4 align-items-lg-center">

				<li class="nav-item">
					<a class="nav-link d-flex align-items-center gap-2" href="{{ path('app_home') }}">
						<i class="bi bi-house"></i>
						Accueil
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link d-flex align-items-center gap-2" href="{{ path('app_apropos') }}">
						<i class="bi bi-info-circle"></i>
						√Ä propos
					</a>
				</li>

				{# ‚úÖ UNIVERS ‚Äì SOUS-BRILLANCE #}
				<li class="nav-item">
					<a class="nav-link d-flex align-items-center gap-2 " href="{{ path('app_categories') }}">
						<i class="bi bi-flower1"></i>
						Univers RouhEnnabta
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link d-flex align-items-center gap-2" href="{{ path('app_certifications') }}">
						<i class="bi bi-patch-check"></i>
						Certifications
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link d-flex align-items-center gap-2" href="#">
						<i class="bi bi-calendar-event"></i>
						√âv√©nements & salons
					</a>
				</li>

			</ul>

			<div
				class="d-flex align-items-center gap-3">

				{# üîç SEARCH #}
				<button class="btn btn-light rounded-circle" data-bs-toggle="modal" data-bs-target="#searchModal">
					<i class="bi bi-search text-secondary"></i>
				</button>

				{# üë§ USER #}
				<button class="btn btn-outline-secondary btn-sm rounded-circle
											d-flex align-items-center justify-content-center" style="width:38px;height:38px;" data-bs-toggle="modal" data-bs-target="{% if app.user %}#userModal{% else %}#accountModal{% endif %}" aria-label="Mon compte">
					<i class="bi bi-person "></i>
				</button>

			</div>

		</div>
	</div>
</nav>



<div class="modal fade" id="searchModal" tabindex="-1">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<div class="modal-content border-0 shadow">

			<div class="modal-header">
				<h5 class="modal-title fw-bold">
					üîç Rechercher un produit
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>

			<div class="modal-body">

				<input type="text" id="searchInput" class="form-control form-control-lg mb-4" placeholder="Tapez le nom d‚Äôun produit‚Ä¶" autocomplete="off"/>

				<div id="searchResults" class="row g-3"></div>

			</div>

		</div>
	</div>
</div>

 <script>
const searchInput = document.getElementById('searchInput');
const searchResults = document.getElementById('searchResults');

let timer = null;

if (searchInput) {
	searchInput.addEventListener('input', () => {
		const q = searchInput.value.trim();
		clearTimeout(timer);

		timer = setTimeout(() => {

			if (q.length < 2) {
				searchResults.innerHTML = '';
				return;
			}

			fetch(`/api/products/search?q=${encodeURIComponent(q)}`)
				.then(r => r.json())
				.then(products => {
					searchResults.innerHTML = '';

					if (!products.length) {
						searchResults.innerHTML = `
							<div class="col-12 text-center text-muted">
								Aucun r√©sultat trouv√©
							</div>
						`;
						return;
					}





					products.forEach(p => {
const productShowPath = "{{ path('product_show', {'slug': 'SLUG'}) }}";
			
			const linkProduct = productShowPath.replace('SLUG', p.slug);

						searchResults.innerHTML += `
							<div class="col-12">
								<div class="d-flex justify-content-between align-items-center border-bottom py-3">
									<div>
										<h6 class="mb-1 fw-semibold">${p.name}</h6>
										<small class="text-muted">
											${p.category ?? ''} ${p.gamme ? '‚Ä¢ ' + p.gamme : ''}
										</small>
									</div>
<a href="${linkProduct}" class="btn btn-sm btn-outline-success">


										Voir
									</a>
								</div>
							</div>
						`;
					});
				});
		}, 300);
	});
}
</script>

<div class="modal fade" id="accountModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content border-0 shadow">

			<div class="modal-header">
				<h5 class="modal-title fw-semibold">Acc√®s √† votre espace</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>

			<div class="modal-body px-4">
				<p class="text-muted small mb-4">
					Acc√©dez √† votre espace personnel ou professionnel.
				</p>

				<div class="d-grid gap-3">
					<a href="{{ path('app_login') }}" class="btn btn-success">Connexion</a>
					<a href="#" class="btn btn-outline-secondary">Cr√©er un compte</a>
					<hr>
					<a href="#" class="btn btn-outline-dark">Devenir franchis√©</a>
				</div>
			</div>

			<div class="modal-footer small text-muted justify-content-center">
				Acc√®s s√©curis√© ‚Äî donn√©es prot√©g√©es
			</div>

		</div>
	</div>
</div>

{% if app.user %}
	<div class="modal fade" id="userModal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0 shadow">

				<div class="modal-header">
					<h5 class="modal-title fw-semibold">Mon compte</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<div class="modal-body text-center px-4">

					<div class="mb-4">
						<div class="rounded-circle bg-light d-inline-flex justify-content-center align-items-center mb-2" style="width:56px;height:56px;">
							<i class="bi bi-person fs-4 text-secondary"></i>
						</div>
						<p class="fw-medium mb-0">{{ app.user.email }}</p>
					</div>

					<div class="d-grid gap-2">
						<a href="#" class="btn btn-outline-secondary">Mon profil</a>

						{% if is_granted('ROLE_ADMIN') %}
							<a href="{{ path('admin_dashboard') }}" class="btn btn-outline-dark">Back-office</a>
						{% endif %}

						<hr>
						<a href="{{ path('app_logout') }}" class="btn btn-danger">D√©connexion</a>
					</div>

				</div>

				<div class="modal-footer small text-muted justify-content-center">
					Session active ‚Äî acc√®s s√©curis√©
				</div>

			</div>
		</div>
	</div>
{% endif %}

